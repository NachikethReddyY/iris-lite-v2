/* eslint-disable */
// @ts-nocheck
// Extracted JPEG codec from Chrome Lighthouse bundle (jpeg-js 0.4.4, MIT license)

import { Buffer } from 'buffer';

const noop = () => {};
const assignName = (fn, _name) => fn;

let BW;
const hv = undefined;

const jpegInternals = (() => {
  const d = noop;
  const i = assignName;

d();BW = BW || function(e){return Buffer.from(e).toString("base64")};function Cbe(e){var t=this,n=Math.round,r=Math.floor,a=new Array(64),o=new Array(64),s=new Array(64),c=new Array(64),u,l,m,p,f=new Array(65535),h=new Array(65535),y=new Array(64),b=new Array(64),w=[],D=0,T=7,S=new Array(64),k=new Array(64),_=new Array(64),Y=new Array(256),W=new Array(2048),oe,me=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],De=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],Oe=[0,1,2,3,4,5,6,7,8,9,10,11],we=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],ve=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,
146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],Dt=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Fe=[0,1,2,3,4,5,6,7,8,9,10,11],ze=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],_t=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function yt(ne){for(var _e=[16,11,10,16,24,40,51,
61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],Re=0;Re<64;Re++){var Ae=r((_e[Re]*ne+50)/100);Ae<1?Ae=1:Ae>255&&(Ae=255),a[me[Re]]=Ae}for(var Ye=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],ot=0;ot<64;ot++){var ht=r((Ye[ot]*ne+50)/100);ht<1?ht=1:ht>255&&(ht=255),o[me[ot]]=ht}for(var lt=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],nn=0,jt=0;jt<8;jt++)for(var ce=0;ce<8;ce++)s[nn]=1/(a[me[nn]]*lt[jt]*lt[ce]*8),c[nn]=1/(o[me[nn]]*lt[jt]*lt[ce]*8),nn++}i(yt,"initQuantTables");function tt(ne,_e){for(var Re=0,Ae=0,Ye=new Array,ot=1;ot<=16;ot++){for(var ht=1;ht<=ne[ot];ht++)Ye[_e[Ae]]=[],Ye[_e[Ae]][0]=Re,Ye[_e[Ae]][1]=ot,Ae++,Re++;Re*=2}return Ye}i(tt,"computeHuffmanTbl");function $t(){u=
tt(De,Oe),l=tt(Dt,Fe),m=tt(we,ve),p=tt(ze,_t)}i($t,"initHuffmanTbl");function pt(){for(var ne=1,_e=2,Re=1;Re<=15;Re++){for(var Ae=ne;Ae<_e;Ae++)h[32767+Ae]=Re,f[32767+Ae]=[],f[32767+Ae][1]=Re,f[32767+Ae][0]=Ae;for(var Ye=-(_e-1);Ye<=-ne;Ye++)h[32767+Ye]=Re,f[32767+Ye]=[],f[32767+Ye][1]=Re,f[32767+Ye][0]=_e-1+Ye;ne<<=1,_e<<=1}}i(pt,"initCategoryNumber");function ft(){for(var ne=0;ne<256;ne++)W[ne]=19595*ne,W[ne+256>>0]=38470*ne,W[ne+512>>0]=7471*ne+32768,W[ne+768>>0]=-11059*ne,W[ne+1024>>0]=-21709*ne,W[ne+1280>>0]=32768*ne+8421375,W[ne+1536>>0]=-27439*ne,W[ne+1792>>0]=-5329*ne}i(ft,"initRGBYUVTable");function Xe(ne){for(var _e=ne[0],Re=ne[1]-1;Re>=0;)_e&1<<Re&&(D|=1<<T),Re--,T--,T<0&&(D==255?(J(255),J(0)):J(D),T=7,D=0)}i(Xe,"writeBits");function J(ne){w.push(ne)}i(J,"writeByte");function Ie(ne){J(ne>>8&255),J(ne&255)}i(Ie,"writeWord");function Ft(ne,_e){var Re,Ae,Ye,ot,ht,lt,nn,jt,ce=0,Ce,Ke=8,Xt=64;for(Ce=0;Ce<Ke;++Ce){Re=ne[ce],Ae=ne[ce+1],Ye=ne[ce+2],ot=ne[ce+3],ht=ne[ce+4],lt=ne[ce+
5],nn=ne[ce+6],jt=ne[ce+7];var nt=Re+jt,vt=Re-jt,Wt=Ae+nn,He=Ae-nn,Ot=Ye+lt,Fn=Ye-lt,Jt=ot+ht,Qn=ot-ht,Cr=nt+Jt,qa=nt-Jt,xo=Wt+Ot,Do=Wt-Ot;ne[ce]=Cr+xo,ne[ce+4]=Cr-xo;var Fs=(Do+qa)*.707106781;ne[ce+2]=qa+Fs,ne[ce+6]=qa-Fs,Cr=Qn+Fn,xo=Fn+He,Do=He+vt;var Rs=(Cr-Do)*.382683433,Hc=.5411961*Cr+Rs,_s=1.306562965*Do+Rs,Ms=xo*.707106781,Os=vt+Ms,Ns=vt-Ms;ne[ce+5]=Ns+Hc,ne[ce+3]=Ns-Hc,ne[ce+1]=Os+_s,ne[ce+7]=Os-_s,ce+=8}for(ce=0,Ce=0;Ce<Ke;++Ce){Re=ne[ce],Ae=ne[ce+8],Ye=ne[ce+16],ot=ne[ce+24],ht=ne[ce+32],lt=ne[ce+40],nn=ne[ce+48],jt=ne[ce+56];var Ql=Re+jt,Wc=Re-jt,ah=Ae+nn,oh=Ae-nn,ih=Ye+lt,Ps=Ye-lt,ed=ot+ht,$v=ot-ht,Ls=Ql+ed,td=Ql-ed,Gc=ah+ih,Bs=ah-ih;ne[ce]=Ls+Gc,ne[ce+32]=Ls-Gc;var sh=(Bs+td)*.707106781;ne[ce+16]=td+sh,ne[ce+48]=td-sh,Ls=$v+Ps,Gc=Ps+oh,Bs=oh+Wc;var ch=(Ls-Bs)*.382683433,uh=.5411961*Ls+ch,lh=1.306562965*Bs+ch,nd=Gc*.707106781,rd=Wc+nd,dh=Wc-nd;ne[ce+40]=dh+uh,ne[ce+24]=dh-uh,ne[ce+8]=rd+lh,ne[ce+56]=rd-lh,ce++}var Vc;for(Ce=0;Ce<Xt;++Ce)Vc=ne[Ce]*_e[Ce],y[Ce]=Vc>0?Vc+.5|0:Vc-
.5|0;return y}i(Ft,"fDCTQuant");function at(){Ie(65504),Ie(16),J(74),J(70),J(73),J(70),J(0),J(1),J(1),J(0),Ie(1),Ie(1),J(0),J(0)}i(at,"writeAPP0");function Ge(ne){if(ne){Ie(65505),ne[0]===69&&ne[1]===120&&ne[2]===105&&ne[3]===102?Ie(ne.length+2):(Ie(ne.length+5+2),J(69),J(120),J(105),J(102),J(0));for(var _e=0;_e<ne.length;_e++)J(ne[_e])}}i(Ge,"writeAPP1");function Be(ne,_e){Ie(65472),Ie(17),J(8),Ie(_e),Ie(ne),J(3),J(1),J(17),J(0),J(2),J(17),J(1),J(3),J(17),J(1)}i(Be,"writeSOF0");function Ue(){Ie(65499),Ie(132),J(0);for(var ne=0;ne<64;ne++)J(a[ne]);J(1);for(var _e=0;_e<64;_e++)J(o[_e])}i(Ue,"writeDQT");function be(){Ie(65476),Ie(418),J(0);for(var ne=0;ne<16;ne++)J(De[ne+1]);for(var _e=0;_e<=11;_e++)J(Oe[_e]);J(16);for(var Re=0;Re<16;Re++)J(we[Re+1]);for(var Ae=0;Ae<=161;Ae++)J(ve[Ae]);J(1);for(var Ye=0;Ye<16;Ye++)J(Dt[Ye+1]);for(var ot=0;ot<=11;ot++)J(Fe[ot]);J(17);for(var ht=0;ht<16;ht++)J(ze[ht+1]);for(var lt=0;lt<=161;lt++)J(_t[lt])}i(be,"writeDHT");function de(ne){typeof ne>"u"||ne.
constructor!==Array||ne.forEach(_e=>{if(typeof _e=="string"){Ie(65534);var Re=_e.length;Ie(Re+2);var Ae;for(Ae=0;Ae<Re;Ae++)J(_e.charCodeAt(Ae))}})}i(de,"writeCOM");function Mt(){Ie(65498),Ie(12),J(3),J(1),J(0),J(2),J(17),J(3),J(17),J(0),J(63),J(0)}i(Mt,"writeSOS");function Ve(ne,_e,Re,Ae,Ye){for(var ot=Ye[0],ht=Ye[240],lt,nn=16,jt=63,ce=64,Ce=Ft(ne,_e),Ke=0;Ke<ce;++Ke)b[me[Ke]]=Ce[Ke];var Xt=b[0]-Re;Re=b[0],Xt==0?Xe(Ae[0]):(lt=32767+Xt,Xe(Ae[h[lt]]),Xe(f[lt]));for(var nt=63;nt>0&&b[nt]==0;nt--);if(nt==0)return Xe(ot),Re;for(var vt=1,Wt;vt<=nt;){for(var He=vt;b[vt]==0&&vt<=nt;++vt);var Ot=vt-He;if(Ot>=nn){Wt=Ot>>4;for(var Fn=1;Fn<=Wt;++Fn)Xe(ht);Ot=Ot&15}lt=32767+b[vt],Xe(Ye[(Ot<<4)+h[lt]]),Xe(f[lt]),vt++}return nt!=jt&&Xe(ot),Re}i(Ve,"processDU");function $e(){for(var ne=String.fromCharCode,_e=0;_e<256;_e++)Y[_e]=ne(_e)}i($e,"initCharLookupTable"),this.encode=function(ne,_e){var Re=new Date().getTime();_e&&Tr(_e),w=new Array,D=0,T=7,Ie(65496),at(),de(ne.comments),Ge(ne.exifBuffer),Ue(),
Be(ne.width,ne.height),be(),Mt();var Ae=0,Ye=0,ot=0;D=0,T=7,this.encode.displayName="_encode_";for(var ht=ne.data,lt=ne.width,nn=ne.height,jt=lt*4,ce=lt*3,Ce,Ke=0,Xt,nt,vt,Wt,He,Ot,Fn,Jt;Ke<nn;){for(Ce=0;Ce<jt;){for(Wt=jt*Ke+Ce,He=Wt,Ot=-1,Fn=0,Jt=0;Jt<64;Jt++)Fn=Jt>>3,Ot=(Jt&7)*4,He=Wt+Fn*jt+Ot,Ke+Fn>=nn&&(He-=jt*(Ke+1+Fn-nn)),Ce+Ot>=jt&&(He-=Ce+Ot-jt+4),Xt=ht[He++],nt=ht[He++],vt=ht[He++],S[Jt]=(W[Xt]+W[nt+256>>0]+W[vt+512>>0]>>16)-128,k[Jt]=(W[Xt+768>>0]+W[nt+1024>>0]+W[vt+1280>>0]>>16)-128,_[Jt]=(W[Xt+1280>>0]+W[nt+1536>>0]+W[vt+1792>>0]>>16)-128;Ae=Ve(S,s,Ae,u,m),Ye=Ve(k,c,Ye,l,p),ot=Ve(_,c,ot,l,p),Ce+=32}Ke+=8}if(T>=0){var Qn=[];Qn[1]=T+1,Qn[0]=(1<<T+1)-1,Xe(Qn)}if(Ie(65497),typeof hv>"u")return new Uint8Array(w);return Buffer.from(w);var Cr,qa};function Tr(ne){if(ne<=0&&(ne=1),ne>100&&(ne=100),oe!=ne){var _e=0;ne<50?_e=Math.floor(5e3/ne):_e=Math.floor(200-ne*2),yt(_e),oe=ne}}i(Tr,"setQuality");function Sr(){var ne=new Date().getTime();e||(e=50),$e(),$t(),pt(),ft(),Tr(e);var _e=new Date().
getTime()-ne}i(Sr,"init"),Sr()}i(Cbe,"JPEGEncoder");function LW(e,t){typeof t>"u"&&(t=50);var n=new Cbe(t),r=n.encode(e,t);return{data:r,width:e.width,height:e.height}}

d();var lF=i(function(){"use strict";var t=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),n=4017,r=799,a=3406,o=2276,s=1567,c=3784,u=5793,l=2896;function m(){}i(m,"constructor");function p(T,S){for(var k=0,_=[],Y,W,oe=16;oe>0&&!T[oe-1];)oe--;_.push({children:[],index:0});var me=_[0],De;for(Y=0;Y<oe;Y++){for(W=0;W<T[Y];W++){for(me=_.pop(),me.children[me.index]=S[k];me.index>0;){if(_.length===0)throw new Error("Could not recreate Huffman Table");me=_.pop()}for(me.index++,_.push(me);_.length<=Y;)_.push(De={children:[],index:0}),me.children[me.index]=De.children,me=De;k++}Y+1<oe&&(_.push(De={children:[],index:0}),me.children[me.index]=De.children,me=De)}return _[0].children}i(p,"buildHuffmanTable");function f(T,S,k,_,Y,W,oe,me,De,Oe){var we=k.precision,ve=k.samplesPerLine,Dt=k.scanLines,Fe=k.mcusPerLine,ze=k.progressive,
_t=k.maxH,yt=k.maxV,tt=S,$t=0,pt=0;function ft(){if(pt>0)return pt--,$t>>pt&1;if($t=T[S++],$t==255){var ce=T[S++];if(ce)throw new Error("unexpected marker: "+($t<<8|ce).toString(16))}return pt=7,$t>>>7}i(ft,"readBit");function Xe(ce){for(var Ce=ce,Ke;(Ke=ft())!==null;){if(Ce=Ce[Ke],typeof Ce=="number")return Ce;if(typeof Ce!="object")throw new Error("invalid huffman sequence")}return null}i(Xe,"decodeHuffman");function J(ce){for(var Ce=0;ce>0;){var Ke=ft();if(Ke===null)return;Ce=Ce<<1|Ke,ce--}return Ce}i(J,"receive");function Ie(ce){var Ce=J(ce);return Ce>=1<<ce-1?Ce:Ce+(-1<<ce)+1}i(Ie,"receiveAndExtend");function Ft(ce,Ce){var Ke=Xe(ce.huffmanTableDC),Xt=Ke===0?0:Ie(Ke);Ce[0]=ce.pred+=Xt;for(var nt=1;nt<64;){var vt=Xe(ce.huffmanTableAC),Wt=vt&15,He=vt>>4;if(Wt===0){if(He<15)break;nt+=16;continue}nt+=He;var Ot=t[nt];Ce[Ot]=Ie(Wt),nt++}}i(Ft,"decodeBaseline");function at(ce,Ce){var Ke=Xe(ce.huffmanTableDC),Xt=Ke===0?0:Ie(Ke)<<De;Ce[0]=ce.pred+=Xt}i(at,"decodeDCFirst");function Ge(ce,Ce){
Ce[0]|=ft()<<De}i(Ge,"decodeDCSuccessive");var Be=0;function Ue(ce,Ce){if(Be>0){Be--;return}for(var Ke=W,Xt=oe;Ke<=Xt;){var nt=Xe(ce.huffmanTableAC),vt=nt&15,Wt=nt>>4;if(vt===0){if(Wt<15){Be=J(Wt)+(1<<Wt)-1;break}Ke+=16;continue}Ke+=Wt;var He=t[Ke];Ce[He]=Ie(vt)*(1<<De),Ke++}}i(Ue,"decodeACFirst");var be=0,de;function Mt(ce,Ce){for(var Ke=W,Xt=oe,nt=0;Ke<=Xt;){var vt=t[Ke],Wt=Ce[vt]<0?-1:1;switch(be){case 0:var He=Xe(ce.huffmanTableAC),Ot=He&15,nt=He>>4;if(Ot===0)nt<15?(Be=J(nt)+(1<<nt),be=4):(nt=16,be=1);else{if(Ot!==1)throw new Error("invalid ACn encoding");de=Ie(Ot),be=nt?2:3}continue;case 1:case 2:Ce[vt]?Ce[vt]+=(ft()<<De)*Wt:(nt--,nt===0&&(be=be==2?3:0));break;case 3:Ce[vt]?Ce[vt]+=(ft()<<De)*Wt:(Ce[vt]=de<<De,be=0);break;case 4:Ce[vt]&&(Ce[vt]+=(ft()<<De)*Wt);break}Ke++}be===4&&(Be--,Be===0&&(be=0))}i(Mt,"decodeACSuccessive");function Ve(ce,Ce,Ke,Xt,nt){var vt=Ke/Fe|0,Wt=Ke%Fe,He=vt*ce.v+Xt,Ot=Wt*ce.h+nt;ce.blocks[He]===void 0&&Oe.tolerantDecoding||Ce(ce,ce.blocks[He][Ot])}i(Ve,"\
decodeMcu");function $e(ce,Ce,Ke){var Xt=Ke/ce.blocksPerLine|0,nt=Ke%ce.blocksPerLine;ce.blocks[Xt]===void 0&&Oe.tolerantDecoding||Ce(ce,ce.blocks[Xt][nt])}i($e,"decodeBlock");var Tr=_.length,Sr,ne,_e,Re,Ae,Ye;ze?W===0?Ye=me===0?at:Ge:Ye=me===0?Ue:Mt:Ye=Ft;var ot=0,ht,lt;Tr==1?lt=_[0].blocksPerLine*_[0].blocksPerColumn:lt=Fe*k.mcusPerColumn,Y||(Y=lt);for(var nn,jt;ot<lt;){for(ne=0;ne<Tr;ne++)_[ne].pred=0;if(Be=0,Tr==1)for(Sr=_[0],Ae=0;Ae<Y;Ae++)$e(Sr,Ye,ot),ot++;else for(Ae=0;Ae<Y;Ae++){for(ne=0;ne<Tr;ne++)for(Sr=_[ne],nn=Sr.h,jt=Sr.v,_e=0;_e<jt;_e++)for(Re=0;Re<nn;Re++)Ve(Sr,Ye,ot,_e,Re);if(ot++,ot===lt)break}if(ot===lt)do{if(T[S]===255&&T[S+1]!==0)break;S+=1}while(S<T.length-2);if(pt=0,ht=T[S]<<8|T[S+1],ht<65280)throw new Error("marker was not found");if(ht>=65488&&ht<=65495)S+=2;else break}return S-tt}i(f,"decodeScan");function h(T,S){var k=[],_=S.blocksPerLine,Y=S.blocksPerColumn,W=_<<3,oe=new Int32Array(64),me=new Uint8Array(64);function De(tt,$t,pt){var ft=S.quantizationTable,Xe,
J,Ie,Ft,at,Ge,Be,Ue,be,de=pt,Mt;for(Mt=0;Mt<64;Mt++)de[Mt]=tt[Mt]*ft[Mt];for(Mt=0;Mt<8;++Mt){var Ve=8*Mt;if(de[1+Ve]==0&&de[2+Ve]==0&&de[3+Ve]==0&&de[4+Ve]==0&&de[5+Ve]==0&&de[6+Ve]==0&&de[7+Ve]==0){be=u*de[0+Ve]+512>>10,de[0+Ve]=be,de[1+Ve]=be,de[2+Ve]=be,de[3+Ve]=be,de[4+Ve]=be,de[5+Ve]=be,de[6+Ve]=be,de[7+Ve]=be;continue}Xe=u*de[0+Ve]+128>>8,J=u*de[4+Ve]+128>>8,Ie=de[2+Ve],Ft=de[6+Ve],at=l*(de[1+Ve]-de[7+Ve])+128>>8,Ue=l*(de[1+Ve]+de[7+Ve])+128>>8,Ge=de[3+Ve]<<4,Be=de[5+Ve]<<4,be=Xe-J+1>>1,Xe=Xe+J+1>>1,J=be,be=Ie*c+Ft*s+128>>8,Ie=Ie*s-Ft*c+128>>8,Ft=be,be=at-Be+1>>1,at=at+Be+1>>1,Be=be,be=Ue+Ge+1>>1,Ge=Ue-Ge+1>>1,Ue=be,be=Xe-Ft+1>>1,Xe=Xe+Ft+1>>1,Ft=be,be=J-Ie+1>>1,J=J+Ie+1>>1,Ie=be,be=at*o+Ue*a+2048>>12,at=at*a-Ue*o+2048>>12,Ue=be,be=Ge*r+Be*n+2048>>12,Ge=Ge*n-Be*r+2048>>12,Be=be,de[0+Ve]=Xe+Ue,de[7+Ve]=Xe-Ue,de[1+Ve]=J+Be,de[6+Ve]=J-Be,de[2+Ve]=Ie+Ge,de[5+Ve]=Ie-Ge,de[3+Ve]=Ft+at,de[4+Ve]=Ft-at}for(Mt=0;Mt<8;++Mt){var $e=Mt;if(de[8+$e]==0&&de[16+$e]==0&&de[24+$e]==0&&de[32+$e]==0&&
de[40+$e]==0&&de[48+$e]==0&&de[56+$e]==0){be=u*pt[Mt+0]+8192>>14,de[0+$e]=be,de[8+$e]=be,de[16+$e]=be,de[24+$e]=be,de[32+$e]=be,de[40+$e]=be,de[48+$e]=be,de[56+$e]=be;continue}Xe=u*de[0+$e]+2048>>12,J=u*de[32+$e]+2048>>12,Ie=de[16+$e],Ft=de[48+$e],at=l*(de[8+$e]-de[56+$e])+2048>>12,Ue=l*(de[8+$e]+de[56+$e])+2048>>12,Ge=de[24+$e],Be=de[40+$e],be=Xe-J+1>>1,Xe=Xe+J+1>>1,J=be,be=Ie*c+Ft*s+2048>>12,Ie=Ie*s-Ft*c+2048>>12,Ft=be,be=at-Be+1>>1,at=at+Be+1>>1,Be=be,be=Ue+Ge+1>>1,Ge=Ue-Ge+1>>1,Ue=be,be=Xe-Ft+1>>1,Xe=Xe+Ft+1>>1,Ft=be,be=J-Ie+1>>1,J=J+Ie+1>>1,Ie=be,be=at*o+Ue*a+2048>>12,at=at*a-Ue*o+2048>>12,Ue=be,be=Ge*r+Be*n+2048>>12,Ge=Ge*n-Be*r+2048>>12,Be=be,de[0+$e]=Xe+Ue,de[56+$e]=Xe-Ue,de[8+$e]=J+Be,de[48+$e]=J-Be,de[16+$e]=Ie+Ge,de[40+$e]=Ie-Ge,de[24+$e]=Ft+at,de[32+$e]=Ft-at}for(Mt=0;Mt<64;++Mt){var Tr=128+(de[Mt]+8>>4);$t[Mt]=Tr<0?0:Tr>255?255:Tr}}i(De,"quantizeAndInverse"),D(W*Y*8);for(var Oe,we,ve=0;ve<Y;ve++){var Dt=ve<<3;for(Oe=0;Oe<8;Oe++)k.push(new Uint8Array(W));for(var Fe=0;Fe<_;Fe++){
De(S.blocks[ve][Fe],me,oe);var ze=0,_t=Fe<<3;for(we=0;we<8;we++){var yt=k[Dt+we];for(Oe=0;Oe<8;Oe++)yt[_t+Oe]=me[ze++]}}}return k}i(h,"buildComponentData");function y(T){return T<0?0:T>255?255:T}i(y,"clampTo8bit"),m.prototype={load:i(function(S){var k=new XMLHttpRequest;k.open("GET",S,!0),k.responseType="arraybuffer",k.onload=function(){var _=new Uint8Array(k.response||k.mozResponseArrayBuffer);this.parse(_),this.onload&&this.onload()}.bind(this),k.send(null)},"load"),parse:i(function(S){var k=this.opts.maxResolutionInMP*1e3*1e3,_=0,Y=S.length;function W(){var He=S[_]<<8|S[_+1];return _+=2,He}i(W,"readUint16");function oe(){var He=W(),Ot=S.subarray(_,_+He-2);return _+=Ot.length,Ot}i(oe,"readDataBlock");function me(He){var Ot=1,Fn=1,Jt,Qn;for(Qn in He.components)He.components.hasOwnProperty(Qn)&&(Jt=He.components[Qn],Ot<Jt.h&&(Ot=Jt.h),Fn<Jt.v&&(Fn=Jt.v));var Cr=Math.ceil(He.samplesPerLine/8/Ot),qa=Math.ceil(He.scanLines/8/Fn);for(Qn in He.components)if(He.components.hasOwnProperty(Qn)){
Jt=He.components[Qn];var xo=Math.ceil(Math.ceil(He.samplesPerLine/8)*Jt.h/Ot),Do=Math.ceil(Math.ceil(He.scanLines/8)*Jt.v/Fn),Fs=Cr*Jt.h,Rs=qa*Jt.v,Hc=Rs*Fs,_s=[];D(Hc*256);for(var Ms=0;Ms<Rs;Ms++){for(var Os=[],Ns=0;Ns<Fs;Ns++)Os.push(new Int32Array(64));_s.push(Os)}Jt.blocksPerLine=xo,Jt.blocksPerColumn=Do,Jt.blocks=_s}He.maxH=Ot,He.maxV=Fn,He.mcusPerLine=Cr,He.mcusPerColumn=qa}i(me,"prepareComponents");var De=null,Oe=null,we=null,ve,Dt,Fe=[],ze=[],_t=[],yt=[],tt=W(),$t=-1;if(this.comments=[],tt!=65496)throw new Error("SOI not found");for(tt=W();tt!=65497;){var pt,ft,Xe;switch(tt){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var J=oe();if(tt===65534){var Ie=String.fromCharCode.apply(null,J);this.comments.push(Ie)}tt===65504&&J[0]===74&&J[1]===70&&J[2]===73&&J[3]===70&&J[4]===0&&(De={version:{major:J[5],minor:J[6]},densityUnits:J[7],
xDensity:J[8]<<8|J[9],yDensity:J[10]<<8|J[11],thumbWidth:J[12],thumbHeight:J[13],thumbData:J.subarray(14,14+3*J[12]*J[13])}),tt===65505&&J[0]===69&&J[1]===120&&J[2]===105&&J[3]===102&&J[4]===0&&(this.exifBuffer=J.subarray(5,J.length)),tt===65518&&J[0]===65&&J[1]===100&&J[2]===111&&J[3]===98&&J[4]===101&&J[5]===0&&(Oe={version:J[6],flags0:J[7]<<8|J[8],flags1:J[9]<<8|J[10],transformCode:J[11]});break;case 65499:for(var Ft=W(),at=Ft+_-2;_<at;){var Ge=S[_++];D(256);var Be=new Int32Array(64);if(Ge>>4)if(Ge>>4===1)for(ft=0;ft<64;ft++){var Ue=t[ft];Be[Ue]=W()}else throw new Error("DQT: invalid table spec");else for(ft=0;ft<64;ft++){var Ue=t[ft];Be[Ue]=S[_++]}Fe[Ge&15]=Be}break;case 65472:case 65473:case 65474:W(),ve={},ve.extended=tt===65473,ve.progressive=tt===65474,ve.precision=S[_++],ve.scanLines=W(),ve.samplesPerLine=W(),ve.components={},ve.componentsOrder=[];var be=ve.scanLines*ve.samplesPerLine;if(be>k){var de=Math.ceil((be-k)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${de}\
MP`)}var Mt=S[_++],Ve,$e=0,Tr=0;for(pt=0;pt<Mt;pt++){Ve=S[_];var Sr=S[_+1]>>4,ne=S[_+1]&15,_e=S[_+2];if(Sr<=0||ne<=0)throw new Error("Invalid sampling factor, expected values above 0");ve.componentsOrder.push(Ve),ve.components[Ve]={h:Sr,v:ne,quantizationIdx:_e},_+=3}me(ve),ze.push(ve);break;case 65476:var Re=W();for(pt=2;pt<Re;){var Ae=S[_++],Ye=new Uint8Array(16),ot=0;for(ft=0;ft<16;ft++,_++)ot+=Ye[ft]=S[_];D(16+ot);var ht=new Uint8Array(ot);for(ft=0;ft<ot;ft++,_++)ht[ft]=S[_];pt+=17+ot,(Ae>>4?_t:yt)[Ae&15]=p(Ye,ht)}break;case 65501:W(),Dt=W();break;case 65500:W(),W();break;case 65498:var lt=W(),nn=S[_++],jt=[],ce;for(pt=0;pt<nn;pt++){ce=ve.components[S[_++]];var Ce=S[_++];ce.huffmanTableDC=yt[Ce>>4],ce.huffmanTableAC=_t[Ce&15],jt.push(ce)}var Ke=S[_++],Xt=S[_++],nt=S[_++],vt=f(S,_,ve,jt,Dt,Ke,Xt,nt>>4,nt&15,this.opts);_+=vt;break;case 65535:S[_]!==255&&_--;break;default:if(S[_-3]==255&&S[_-2]>=192&&S[_-2]<=254){_-=3;break}else if(tt===224||tt==225){if($t!==-1)throw new Error(`first u\
nknown JPEG marker at offset ${$t.toString(16)}, second unknown JPEG marker ${tt.toString(16)} at offset ${(_-1).toString(16)}`);$t=_-1;let He=W();if(S[_+He-2]===255){_+=He-2;break}}throw new Error("unknown JPEG marker "+tt.toString(16))}tt=W()}if(ze.length!=1)throw new Error("only single frame JPEGs supported");for(var pt=0;pt<ze.length;pt++){var Wt=ze[pt].components;for(var ft in Wt)Wt[ft].quantizationTable=Fe[Wt[ft].quantizationIdx],delete Wt[ft].quantizationIdx}this.width=ve.samplesPerLine,this.height=ve.scanLines,this.jfif=De,this.adobe=Oe,this.components=[];for(var pt=0;pt<ve.componentsOrder.length;pt++){var ce=ve.components[ve.componentsOrder[pt]];this.components.push({lines:h(ve,ce),scaleX:ce.h/ve.maxH,scaleY:ce.v/ve.maxV})}},"parse"),getData:i(function(S,k){var _=this.width/S,Y=this.height/k,W,oe,me,De,Oe,we,ve,Dt,Fe,ze,_t=0,yt,tt,$t,pt,ft,Xe,J,Ie,Ft,at,Ge,Be=S*k*this.components.length;D(Be);var Ue=new Uint8Array(Be);switch(this.components.length){case 1:for(W=this.components[0],
ze=0;ze<k;ze++)for(Oe=W.lines[0|ze*W.scaleY*Y],Fe=0;Fe<S;Fe++)yt=Oe[0|Fe*W.scaleX*_],Ue[_t++]=yt;break;case 2:for(W=this.components[0],oe=this.components[1],ze=0;ze<k;ze++)for(Oe=W.lines[0|ze*W.scaleY*Y],we=oe.lines[0|ze*oe.scaleY*Y],Fe=0;Fe<S;Fe++)yt=Oe[0|Fe*W.scaleX*_],Ue[_t++]=yt,yt=we[0|Fe*oe.scaleX*_],Ue[_t++]=yt;break;case 3:for(Ge=!0,this.adobe&&this.adobe.transformCode?Ge=!0:typeof this.opts.colorTransform<"u"&&(Ge=!!this.opts.colorTransform),W=this.components[0],oe=this.components[1],me=this.components[2],ze=0;ze<k;ze++)for(Oe=W.lines[0|ze*W.scaleY*Y],we=oe.lines[0|ze*oe.scaleY*Y],ve=me.lines[0|ze*me.scaleY*Y],Fe=0;Fe<S;Fe++)Ge?(yt=Oe[0|Fe*W.scaleX*_],tt=we[0|Fe*oe.scaleX*_],$t=ve[0|Fe*me.scaleX*_],Ie=y(yt+1.402*($t-128)),Ft=y(yt-.3441363*(tt-128)-.71413636*($t-128)),at=y(yt+1.772*(tt-128))):(Ie=Oe[0|Fe*W.scaleX*_],Ft=we[0|Fe*oe.scaleX*_],at=ve[0|Fe*me.scaleX*_]),Ue[_t++]=Ie,Ue[_t++]=Ft,Ue[_t++]=at;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 componen\
ts)");for(Ge=!1,this.adobe&&this.adobe.transformCode?Ge=!0:typeof this.opts.colorTransform<"u"&&(Ge=!!this.opts.colorTransform),W=this.components[0],oe=this.components[1],me=this.components[2],De=this.components[3],ze=0;ze<k;ze++)for(Oe=W.lines[0|ze*W.scaleY*Y],we=oe.lines[0|ze*oe.scaleY*Y],ve=me.lines[0|ze*me.scaleY*Y],Dt=De.lines[0|ze*De.scaleY*Y],Fe=0;Fe<S;Fe++)Ge?(yt=Oe[0|Fe*W.scaleX*_],tt=we[0|Fe*oe.scaleX*_],$t=ve[0|Fe*me.scaleX*_],pt=Dt[0|Fe*De.scaleX*_],ft=255-y(yt+1.402*($t-128)),Xe=255-y(yt-.3441363*(tt-128)-.71413636*($t-128)),J=255-y(yt+1.772*(tt-128))):(ft=Oe[0|Fe*W.scaleX*_],Xe=we[0|Fe*oe.scaleX*_],J=ve[0|Fe*me.scaleX*_],pt=Dt[0|Fe*De.scaleX*_]),Ue[_t++]=255-ft,Ue[_t++]=255-Xe,Ue[_t++]=255-J,Ue[_t++]=255-pt;break;default:throw new Error("Unsupported color mode")}return Ue},"getData"),copyToImageData:i(function(S,k){var _=S.width,Y=S.height,W=S.data,oe=this.getData(_,Y),me=0,De=0,Oe,we,ve,Dt,Fe,ze,_t,yt,tt;switch(this.components.length){case 1:for(we=0;we<Y;we++)for(Oe=0;Oe<
_;Oe++)ve=oe[me++],W[De++]=ve,W[De++]=ve,W[De++]=ve,k&&(W[De++]=255);break;case 3:for(we=0;we<Y;we++)for(Oe=0;Oe<_;Oe++)_t=oe[me++],yt=oe[me++],tt=oe[me++],W[De++]=_t,W[De++]=yt,W[De++]=tt,k&&(W[De++]=255);break;case 4:for(we=0;we<Y;we++)for(Oe=0;Oe<_;Oe++)Fe=oe[me++],ze=oe[me++],ve=oe[me++],Dt=oe[me++],_t=255-y(Fe*(1-Dt/255)+Dt),yt=255-y(ze*(1-Dt/255)+Dt),tt=255-y(ve*(1-Dt/255)+Dt),W[De++]=_t,W[De++]=yt,W[De++]=tt,k&&(W[De++]=255);break;default:throw new Error("Unsupported color mode")}},"copyToImageData")};var b=0,w=0;function D(T=0){var S=b+T;if(S>w){var k=Math.ceil((S-w)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${k}MB`)}b=S}return i(D,"requestMemoryAllocation"),m.resetMaxMemoryUsage=function(T){b=0,w=T},m.getBytesAllocated=function(){return b},m.requestMemoryAllocation=D,m},"jpegImage")();function jW(e,t={}){var n={colorTransform:void 0,
useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512},r={...n,...t},a=new Uint8Array(e),o=new lF;o.opts=r,lF.resetMaxMemoryUsage(r.maxMemoryUsageInMB*1024*1024),o.parse(a);var s=r.formatAsRGBA?4:3,c=o.width*o.height*s;try{lF.requestMemoryAllocation(c);var u={width:o.width,height:o.height,exifBuffer:o.exifBuffer,data:r.useTArray?new Uint8Array(c):Buffer.alloc(c)};o.comments.length>0&&(u.comments=o.comments)}catch(l){throw l instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+c):l instanceof ReferenceError&&l.message==="Buffer is not defined"?new Error("Buffer is not globally defined in this environment. Consider setting useTArray to true"):l}return o.copyToImageData(u,r.formatAsRGBA),u}

  return { encode: LW, decode: jW };
})();

export const encodeJpeg = (image, quality) => jpegInternals.encode(image, quality);
export const decodeJpeg = (buffer, options = {}) => {
  const input = buffer instanceof Uint8Array ? buffer : new Uint8Array(buffer);
  return jpegInternals.decode(input, { useTArray: true, formatAsRGBA: true, ...options });
};
